import{S as ie,b as ae,s as z,d as I,k as y,m as b,o as K,p as R,e as x,A as ce,q as fe,D as ue,v as pe,K as O,L as j,x as D,M as N,z as L,y as v,g as H,j as X,c as me,f as U,t as P,n as J}from"./utils-Dhpz6cMF.js";import"./index-DOampWFA.js";import{G as ge}from"./GameFrame-CzJCdGM3.js";import W from"./Math-DRVBjLM2.js";/* empty css                                           */const de=[{id:1,topics:["derivative-poly"],total:10,desc:"Derivadas de polinomios simples"},{id:2,topics:["integral-poly"],total:10,desc:"Integrales de polinomios básicas"},{id:3,topics:["derivative-trig"],total:12,desc:"Derivadas trigonométricas"},{id:4,topics:["differential-poly"],total:12,desc:"Diferenciales: dy = f’(x) dx"},{id:5,topics:["derivative-poly","integral-poly","derivative-trig","differential-poly"],total:14,desc:"Mixto de cálculo"}];function Y(r){return de.find(t=>t.id===r)}function _e(r){return Y(r+1)}function m(r,t){if(globalThis.crypto){const e=new Uint32Array(1);globalThis.crypto.getRandomValues(e);const n=e[0]/(2**32-1);return Math.floor(n*(t-r+1))+r}return Math.floor(Math.random()*(t-r+1))+r}function S(r){return r==="derivative-trig"?15e3:r==="differential-poly"?19e3:17e3}function E(r){const t=[];r.forEach((n,l)=>{const s=r.length-1-l;if(n===0)return;const a=n>0?"+":"-",f=Math.abs(n);let o="";s===0?o=`${f}`:f===1?o=s===1?"x":`x^{${s}}`:o=s===1?`${f}x`:`${f}x^{${s}}`,t.push(`${a} ${o}`)});let e=t.join(" ");return e=e.replace(/^\+\s?/,"").trim(),e||"0"}function Q(r){const t=[];for(let e=0;e<r.length-1;e++){const n=r.length-1-e;t.push(r[e]*n)}return t.length?t:[0]}function he(r){const t=[];for(let n=0;n<r.length;n++){const s=r.length-1-n+1,a=r[n]/s;if(a===0)continue;const f=a>0?"+":"-",o=Math.abs(a);let i="";s===0?i=`${o}`:o===1?i=s===1?"x":`x^{${s}}`:i=s===1?`${o}x`:`${o}x^{${s}}`,t.push(`${f} ${i}`)}const e=t.join(" ").replace(/^\+\s/,"").trim();return e?`${e} + C`:"C"}function ye(r,t){return r.reduce((e,n)=>e*t+n,0)}function be(r){const t=r[m(0,r.length-1)];if(t==="derivative-poly"){const c=m(1,3),u=Array.from({length:c+1},()=>m(-6,6));u[0]===0&&(u[0]=m(1,6));const d=`\\frac{d}{dx} [${E(u)}]`,_=Q(u),h=E(_).replace(/^\+\s?/,"").trim();return{id:`${Math.random().toString(36).slice(2)}${Date.now().toString(36)}`,question:d,answer:h,topic:t,timeMs:S(t)}}if(t==="integral-poly"){const c=m(0,3),u=Array.from({length:c+1},()=>m(-5,5));u.reduce((M,w)=>M+Math.abs(w),0)===0&&(u[c]=1);const _=`\\int (${E(u)}) \\, dx`,h=he(u);return{id:`${Math.random().toString(36).slice(2)}${Date.now().toString(36)}`,question:_,answer:h,topic:t,timeMs:S(t)}}if(t==="derivative-trig"){const c=["\\sin x","\\cos x","\\tan x"],u=c[m(0,c.length-1)],g=`\\frac{d}{dx} [${u}]`,d=u==="\\sin x"?"\\cos x":u==="\\cos x"?"-\\sin x":"\\sec^{2} x";return{id:`${Math.random().toString(36).slice(2)}${Date.now().toString(36)}`,question:g,answer:d,topic:t,timeMs:S(t)}}const e=m(1,3),n=Array.from({length:e+1},()=>m(-5,5));n[0]===0&&(n[0]=m(1,5));const l=Q(n),s=m(-4,4),a=E(n),f=E(l).replace(/^\+\s?/,""),o=`\\text{If } y = ${a}, \\text{ find } dy \\text{ at } x = ${s} \\text{ } (dy = y'(x) \\, dx)`,i=`dy = (${f}) \\, dx, \\quad y'(${s}) = ${ye(l,s)}`;return{id:`${Math.random().toString(36).slice(2)}${Date.now().toString(36)}`,question:o,answer:i,topic:"differential-poly",timeMs:S(t)}}function Me(r){let t,e;return t=new W({props:{expr:"\\text{Get ready...}"}}),{c(){v(t.$$.fragment)},m(n,l){L(t,n,l),e=!0},p:J,i(n){e||(b(t.$$.fragment,n),e=!0)},o(n){y(t.$$.fragment,n),e=!1},d(n){D(t,n)}}}function we(r){let t,e;return t=new W({props:{expr:`\\text{Time left: } ${(r[7]/1e3).toFixed(1)}\\text{s}`}}),{c(){v(t.$$.fragment)},m(n,l){L(t,n,l),e=!0},p(n,l){const s={};l&128&&(s.expr=`\\text{Time left: } ${(n[7]/1e3).toFixed(1)}\\text{s}`),t.$set(s)},i(n){e||(b(t.$$.fragment,n),e=!0)},o(n){y(t.$$.fragment,n),e=!1},d(n){D(t,n)}}}function Ee(r){let t,e,n,l;const s=[we,Me],a=[];function f(o,i){return o[6]?1:0}return e=f(r),n=a[e]=s[e](r),{c(){t=H("span"),n.c(),X(t,"slot","footer-left")},m(o,i){x(o,t,i),a[e].m(t,null),l=!0},p(o,i){let c=e;e=f(o),e===c?a[e].p(o,i):(K(),y(a[c],1,1,()=>{a[c]=null}),R(),n=a[e],n?n.p(o,i):(n=a[e]=s[e](o),n.c()),b(n,1),n.m(t,null))},i(o){l||(b(n),l=!0)},o(o){y(n),l=!1},d(o){o&&I(t),a[e].d()}}}function Te(r){let t,e,n=r[0].topics.length+"",l;return{c(){t=H("span"),e=P("Topics: "),l=P(n),X(t,"slot","footer-right")},m(s,a){x(s,t,a),U(t,e),U(t,l)},p(s,a){a&1&&n!==(n=s[0].topics.length+"")&&me(l,n)},d(s){s&&I(t)}}}function G(r){let t,e,n,l;function s(o){r[15](o)}function a(o){r[16](o)}let f={title:"Calculus",levelId:r[0].id,total:r[0].total,correct:r[11],showTimer:!r[6],remainingSeconds:r[7]/1e3,question:r[1].question,flash:r[4],penalty:r[5],overlayLabel:r[8],overlayColor:r[9],overlayTrigger:r[10],handleInput:r[12],handleInputKey:r[13],$$slots:{"footer-right":[Te],"footer-left":[Ee]},$$scope:{ctx:r}};return r[3]!==void 0&&(f.inputEl=r[3]),r[2]!==void 0&&(f.input=r[2]),t=new ge({props:f}),O.push(()=>j(t,"inputEl",s)),O.push(()=>j(t,"input",a)),{c(){v(t.$$.fragment)},m(o,i){L(t,o,i),l=!0},p(o,i){const c={};i&1&&(c.levelId=o[0].id),i&1&&(c.total=o[0].total),i&2048&&(c.correct=o[11]),i&64&&(c.showTimer=!o[6]),i&128&&(c.remainingSeconds=o[7]/1e3),i&2&&(c.question=o[1].question),i&16&&(c.flash=o[4]),i&32&&(c.penalty=o[5]),i&256&&(c.overlayLabel=o[8]),i&512&&(c.overlayColor=o[9]),i&1024&&(c.overlayTrigger=o[10]),i&134217921&&(c.$$scope={dirty:i,ctx:o}),!e&&i&8&&(e=!0,c.inputEl=o[3],N(()=>e=!1)),!n&&i&4&&(n=!0,c.input=o[2],N(()=>n=!1)),t.$set(c)},i(o){l||(b(t.$$.fragment,o),l=!0)},o(o){y(t.$$.fragment,o),l=!1},d(o){D(t,o)}}}function Se(r){let t=r[1].id,e,n,l=G(r);return{c(){l.c(),e=ce()},m(s,a){l.m(s,a),x(s,e,a),n=!0},p(s,[a]){a&2&&z(t,t=s[1].id)?(K(),y(l,1,1,J),R(),l=G(s),l.c(),b(l,1),l.m(e.parentNode,e)):l.p(s,a)},i(s){n||(b(l),n=!0)},o(s){y(l),n=!1},d(s){s&&I(e),l.d(s)}}}const V=12e3;function ke(r,t,e){let n;const l=fe();let s=Y(1),a,f="",o=null,i=0,c=!1,u=!1,g=!0,d=0,_=V,h,M=!1;performance.now();let w="",k="",C=0;performance.now();function Z(){return be(s.topics)}function T(){e(1,a=Z()),g?(d=0,e(7,_=a.timeMs)):(d=performance.now()+a.timeMs,e(7,_=a.timeMs)),M=!1,performance.now()}function ee(){e(14,i=0),e(2,f=""),e(4,c=!1),e(6,g=!0),performance.now(),T()}ee();function F(p){let q=p.trim();if(e(2,f=q),!q)return;const $=A=>A.replace(/\\/g,"").replace(/\{(\d+)\}/g,"$1").replace(/frac\{([^}]+)\}\{([^}]+)\}/g,"$1/$2").replace(/\^\{(\w+)\}/g,"^$1").replace(/\^\{([^}]*)\}/g,"^$1").replace(/\s*([-+])\s*/g,"$1").replace(/\s+/g," ").replace(/^\+\s?/,"").replace(/^-\s*0(\s|$)/,"0$1").trim().toLowerCase(),se=$(q),le=$(a.answer);if(se===le){e(8,w="correct"),e(9,k="#BCED09"),e(10,C+=1),e(4,c=!0),e(14,i+=1),l("answer",{correct:!0});const A=i>=s.total;setTimeout(()=>{if(e(2,f=""),e(4,c=!1),A){const B=_e(s.id);B&&(e(0,s=B),e(14,i=0),e(6,g=!0),T())}else e(6,g=!1),T()},200)}}function te(p){F(p.target.value)}function ne(p){p.key==="Enter"&&F(f)}ue(()=>{setTimeout(()=>o==null?void 0:o.focus(),0);const p=()=>{d>0?(e(7,_=Math.max(0,d-performance.now())),!M&&_<=0&&(l("answer",{correct:!1}),M=!0,e(14,i=Math.max(0,i-1)),e(8,w="miss"),e(9,k="#FF715B"),e(10,C+=1),e(5,u=!0),setTimeout(()=>e(5,u=!1),250),e(6,g=!1),e(2,f=""),e(4,c=!1),T())):e(7,_=(a==null?void 0:a.timeMs)??V),h=requestAnimationFrame(p)};d=0,h=requestAnimationFrame(p)}),pe(()=>cancelAnimationFrame(h));function re(p){o=p,e(3,o)}function oe(p){f=p,e(2,f)}return r.$$.update=()=>{r.$$.dirty&16384&&e(11,n=Math.max(0,i))},[s,a,f,o,c,u,g,_,w,k,C,n,te,ne,i,re,oe]}class Le extends ie{constructor(t){super(),ae(this,t,ke,Se,z,{})}}export{Le as default};
