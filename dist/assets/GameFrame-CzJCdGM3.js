import{S as X,b as J,s as Q,G as ne,n as ie,d as M,N as we,c as W,e as P,f as g,g as w,t as A,h as E,j as m,B as se,x as j,k as T,m as q,z as H,y as O,A as Se,K as te,O as G,Q as K,R as N,T as U,D as ze,v as Te,U as qe,r as Ce,V as ae,l as x,i as oe}from"./utils-Dhpz6cMF.js";import"./index-DOampWFA.js";import Ie from"./Math-DRVBjLM2.js";function re(l,e,n){const t=l.slice();return t[7]=e[n],t[9]=n,t}function fe(l){let e;return{c(){e=w("div"),m(e,"class","level-progress__segment svelte-o2qy4o"),se(e,"--seg-color",l[9]<l[2]?l[5](l[0]):"transparent")},m(n,t){P(n,e,t)},p(n,t){t&5&&se(e,"--seg-color",n[9]<n[2]?n[5](n[0]):"transparent")},d(n){n&&M(e)}}}function ue(l){let e,n=l[4].toFixed(1)+"",t,i;return{c(){e=w("div"),t=A(n),i=A("s"),m(e,"class","level-progress__timer svelte-o2qy4o"),m(e,"aria-label","Remaining seconds")},m(s,f){P(s,e,f),g(e,t),g(e,i)},p(s,f){f&16&&n!==(n=s[4].toFixed(1)+"")&&W(t,n)},d(s){s&&M(e)}}}function Le(l){let e,n,t,i,s,f,r,o,u,b,d,p,I,h=ne(Array(l[1])),k=[];for(let c=0;c<h.length;c+=1)k[c]=fe(re(l,h,c));let y=l[3]&&ue(l);return{c(){e=w("div"),n=w("div"),t=A("Level "),i=A(l[0]),s=E(),f=w("div"),r=w("div");for(let c=0;c<k.length;c+=1)k[c].c();o=E(),y&&y.c(),u=E(),b=w("div"),d=A(l[2]),p=A("/"),I=A(l[1]),m(n,"class","level-progress__label svelte-o2qy4o"),m(r,"class","level-progress__segments svelte-o2qy4o"),m(f,"class","level-progress__bar svelte-o2qy4o"),m(b,"class","level-progress__count svelte-o2qy4o"),m(e,"class","level-progress svelte-o2qy4o")},m(c,C){P(c,e,C),g(e,n),g(n,t),g(n,i),g(e,s),g(e,f),g(f,r);for(let _=0;_<k.length;_+=1)k[_]&&k[_].m(r,null);g(f,o),y&&y.m(f,null),g(e,u),g(e,b),g(b,d),g(b,p),g(b,I)},p(c,[C]){if(C&1&&W(i,c[0]),C&39){h=ne(Array(c[1]));let _;for(_=0;_<h.length;_+=1){const S=re(c,h,_);k[_]?k[_].p(S,C):(k[_]=fe(S),k[_].c(),k[_].m(r,null))}for(;_<k.length;_+=1)k[_].d(1);k.length=h.length}c[3]?y?y.p(c,C):(y=ue(c),y.c(),y.m(f,null)):y&&(y.d(1),y=null),C&4&&W(d,c[2]),C&2&&W(I,c[1])},i:ie,o:ie,d(c){c&&M(e),we(k,c),y&&y.d()}}}function Fe(l,e,n){let{levelId:t}=e,{total:i}=e,{correct:s}=e,{showTimer:f}=e,{remainingSeconds:r}=e;const o=["#2F52E0","#BCED09","#F9CB40","#FF715B","#4C5B5C"];function u(b){return o[b%o.length]}return l.$$set=b=>{"levelId"in b&&n(0,t=b.levelId),"total"in b&&n(1,i=b.total),"correct"in b&&n(2,s=b.correct),"showTimer"in b&&n(3,f=b.showTimer),"remainingSeconds"in b&&n(4,r=b.remainingSeconds)},[t,i,s,f,r,u]}class Ee extends X{constructor(e){super(),J(this,e,Fe,Le,Q,{levelId:0,total:1,correct:2,showTimer:3,remainingSeconds:4})}}const $={textSizing:{mobile:{baseFontSize:32,maxFontSize:64,minFontSize:18,scalingFactor:1.2},tablet:{baseFontSize:48,maxFontSize:96,minFontSize:24,scalingFactor:1.1},desktop:{baseFontSize:64,maxFontSize:120,minFontSize:32,scalingFactor:1}},breakpoints:{mobile:600,tablet:768,desktop:1024},timing:{answerTimeout:6e4,flashDuration:250,levelUpDelay:1e3,gameStartDelay:500},fontSize:{base:64,min:18,max:120,scalingSteps:[18,24,32,48,64,96,120]},storage:{theme:"mathraining-theme",gameProgress:"mathraining-progress",settings:"mathraining-settings",highScores:"mathraining-highscores"},features:{enableHighScores:!0,enableTheming:!0,enableResponsiveText:!0,enableGameStats:!0,enableSoundEffects:!1,enableAnimations:!0},performance:{maxBundleSize:150*1024,maxInitialLoadTime:2e3,maxLayoutShift:.1,targetFps:60},accessibility:{reducedMotion:!1,highContrast:!1,largeText:!1,screenReader:!1},debug:{enableLogging:!1,showPerformanceMetrics:!1,enableDevTools:!1}};class ce{static analyzeContent(e){return{isLatex:/\\(dfrac|frac|sqrt|alpha|beta|gamma|cdot|times|plus|minus|div|sum|int)/.test(e),containsMath:/[+\-×÷=<>≤≥≠≈∅∈∉∪∩∏∑∫]/.test(e),length:e.length,wordCount:e.split(/\s+/).length,specialChars:(e.match(/[{}()[\]|]/g)||[]).length,hasNumbers:/\d/.test(e)}}static preprocess(e,n){return n.isLatex?this.preprocessLatex(e):this.preprocessText(e)}static preprocessLatex(e){return e.replace(/([+\-=])/g," $1 ").replace(/\s{2,}/g," ").trim()}static preprocessText(e){return e.replace(/(\d)([a-zA-Z])/g,"$1 $2").replace(/([a-zA-Z])(\d)/g,"$1 $2").replace(/\s{2,}/g," ").trim()}}function De(l,e,n){const t={finalContent:l,fontSize:64,layout:"single",padding:{horizontal:.5,vertical:.25},usedSpace:{width:0,height:0}};if(e&&n)try{const i=ce.analyzeContent(l),s=ce.preprocess(l,i),f=e.clientWidth||400,r=e.clientHeight||200,o=window.innerWidth<=$.breakpoints.mobile;let u=o?$.textSizing.mobile.baseFontSize:$.textSizing.desktop.baseFontSize;i.length>30&&(u*=.8),o&&i.isLatex&&(u*=.75),t.finalContent=s,t.fontSize=Math.max(o?12:16,Math.floor(u)),t.layout=i.length>20&&(i.isLatex||i.containsMath)?"multiline":"single",t.padding=o?{horizontal:.25,vertical:.125}:{horizontal:.5,vertical:.25},e.classList.add(`layout-${t.layout}`),e.style.setProperty("--render-font-size",`${t.fontSize}px`)}catch(i){console.warn("[ProblemRenderer] Rendering error:",i)}return t}function me(l){let e=l[5],n,t=_e(l);return{c(){t.c(),n=Se()},m(i,s){t.m(i,s),P(i,n,s)},p(i,s){s&32&&Q(e,e=i[5])?(t.d(1),t=_e(i),t.c(),t.m(n.parentNode,n)):t.p(i,s)},d(i){i&&M(n),t.d(i)}}}function _e(l){let e,n=l[3].toUpperCase()+"",t,i;return{c(){e=w("div"),t=A(n),m(e,"class",i="judgement "+(l[4]==="multi"?"multi":"")+" svelte-sipmbv"),m(e,"data-label",l[3])},m(s,f){P(s,e,f),g(e,t)},p(s,f){f&8&&n!==(n=s[3].toUpperCase()+"")&&W(t,n),f&16&&i!==(i="judgement "+(s[4]==="multi"?"multi":"")+" svelte-sipmbv")&&m(e,"class",i),f&8&&m(e,"data-label",s[3])},d(s){s&&M(e)}}}function Me(l){var b;let e,n,t,i,s,f,r,o,u=l[3]&&me(l);return s=new Ie({props:{expr:((b=l[8])==null?void 0:b.finalContent)||l[0],display:!0}}),{c(){var d;e=w("div"),u&&u.c(),n=E(),t=w("div"),i=w("div"),O(s.$$.fragment),m(i,"class","fitbox svelte-sipmbv"),m(i,"style",f=`--fsize:${((d=l[8])==null?void 0:d.fontSize)||64}px`),m(t,"class",r="problem-display "+(l[1]?"is-correct":"")+" "+(l[2]?"is-penalty":"")+" svelte-sipmbv"),m(t,"aria-live","polite"),m(t,"role","heading"),m(t,"aria-level","1"),m(e,"class","problem-wrapper svelte-sipmbv")},m(d,p){P(d,e,p),u&&u.m(e,null),g(e,n),g(e,t),g(t,i),H(s,i,null),l[9](i),l[10](t),o=!0},p(d,[p]){var h,k;d[3]?u?u.p(d,p):(u=me(d),u.c(),u.m(e,n)):u&&(u.d(1),u=null);const I={};p&257&&(I.expr=((h=d[8])==null?void 0:h.finalContent)||d[0]),s.$set(I),(!o||p&256&&f!==(f=`--fsize:${((k=d[8])==null?void 0:k.fontSize)||64}px`))&&m(i,"style",f),(!o||p&6&&r!==(r="problem-display "+(d[1]?"is-correct":"")+" "+(d[2]?"is-penalty":"")+" svelte-sipmbv"))&&m(t,"class",r)},i(d){o||(q(s.$$.fragment,d),o=!0)},o(d){T(s.$$.fragment,d),o=!1},d(d){d&&M(e),u&&u.d(),j(s),l[9](null),l[10](null)}}}function Pe(l,e,n){let{question:t=""}=e,{flash:i=!1}=e,{penalty:s=!1}=e,{overlayLabel:f=""}=e,{overlayColor:r=""}=e,{overlayTrigger:o=0}=e,u,b,d;function p(h){te[h?"unshift":"push"](()=>{b=h,n(7,b)})}function I(h){te[h?"unshift":"push"](()=>{u=h,n(6,u)})}return l.$$set=h=>{"question"in h&&n(0,t=h.question),"flash"in h&&n(1,i=h.flash),"penalty"in h&&n(2,s=h.penalty),"overlayLabel"in h&&n(3,f=h.overlayLabel),"overlayColor"in h&&n(4,r=h.overlayColor),"overlayTrigger"in h&&n(5,o=h.overlayTrigger)},l.$$.update=()=>{l.$$.dirty&193&&n(8,d=De(t,u,b))},[t,i,s,f,r,o,u,b,d,p,I]}class Ae extends X{constructor(e){super(),J(this,e,Pe,Me,Q,{question:0,flash:1,penalty:2,overlayLabel:3,overlayColor:4,overlayTrigger:5})}}function ge(l){let e,n;return{c(){e=w("div"),n=A(l[0]),m(e,"class","box-title svelte-ezbcfi")},m(t,i){P(t,e,i),g(e,n)},p(t,i){i&1&&W(n,t[0])},d(t){t&&M(e)}}}function Re(l){let e,n,t,i,s=l[0]&&ge(l);const f=l[3].default,r=G(f,l,l[2],null);return{c(){e=w("div"),s&&s.c(),n=E(),t=w("div"),r&&r.c(),m(t,"class","box-content svelte-ezbcfi"),m(e,"class","game-box svelte-ezbcfi"),m(e,"data-area",l[1])},m(o,u){P(o,e,u),s&&s.m(e,null),g(e,n),g(e,t),r&&r.m(t,null),i=!0},p(o,[u]){o[0]?s?s.p(o,u):(s=ge(o),s.c(),s.m(e,n)):s&&(s.d(1),s=null),r&&r.p&&(!i||u&4)&&K(r,f,o,o[2],i?U(f,o[2],u,null):N(o[2]),null),(!i||u&2)&&m(e,"data-area",o[1])},i(o){i||(q(r,o),i=!0)},o(o){T(r,o),i=!1},d(o){o&&M(e),s&&s.d(),r&&r.d(o)}}}function Be(l,e,n){let{$$slots:t={},$$scope:i}=e,{title:s=void 0}=e,{area:f="problem"}=e;return l.$$set=r=>{"title"in r&&n(0,s=r.title),"area"in r&&n(1,f=r.area),"$$scope"in r&&n(2,i=r.$$scope)},[s,f,i,t]}class Y extends X{constructor(e){super(),J(this,e,Be,Re,Q,{title:0,area:1})}}const Ge=l=>({}),de=l=>({}),Ke=l=>({}),he=l=>({}),Ne=l=>({}),be=l=>({}),Ue=l=>({}),ve=l=>({}),We=l=>({}),pe=l=>({}),je=l=>({}),ye=l=>({}),He=l=>({}),ke=l=>({});function Oe(l){let e,n;return e=new Ae({props:{question:l[8],flash:l[9],penalty:l[10],overlayLabel:l[11],overlayColor:l[12],overlayTrigger:l[13]}}),{c(){O(e.$$.fragment)},m(t,i){H(e,t,i),n=!0},p(t,i){const s={};i&256&&(s.question=t[8]),i&512&&(s.flash=t[9]),i&1024&&(s.penalty=t[10]),i&2048&&(s.overlayLabel=t[11]),i&4096&&(s.overlayColor=t[12]),i&8192&&(s.overlayTrigger=t[13]),e.$set(s)},i(t){n||(q(e.$$.fragment,t),n=!0)},o(t){T(e.$$.fragment,t),n=!1},d(t){j(e,t)}}}function Ve(l){let e,n;return e=new Y({props:{area:"problem",$$slots:{default:[Oe]},$$scope:{ctx:l}}}),{c(){O(e.$$.fragment)},m(t,i){H(e,t,i),n=!0},p(t,i){const s={};i&2113280&&(s.$$scope={dirty:i,ctx:t}),e.$set(s)},i(t){n||(q(e.$$.fragment,t),n=!0)},o(t){T(e.$$.fragment,t),n=!1},d(t){j(e,t)}}}function Ze(l){let e,n;return e=new Y({props:{area:"image",$$slots:{default:[Qe]},$$scope:{ctx:l}}}),{c(){O(e.$$.fragment)},m(t,i){H(e,t,i),n=!0},p(t,i){const s={};i&2097152&&(s.$$scope={dirty:i,ctx:t}),e.$set(s)},i(t){n||(q(e.$$.fragment,t),n=!0)},o(t){T(e.$$.fragment,t),n=!1},d(t){j(e,t)}}}function Qe(l){let e;const n=l[18].image,t=G(n,l,l[21],pe);return{c(){t&&t.c()},m(i,s){t&&t.m(i,s),e=!0},p(i,s){t&&t.p&&(!e||s&2097152)&&K(t,n,i,i[21],e?U(n,i[21],s,We):N(i[21]),pe)},i(i){e||(q(t,i),e=!0)},o(i){T(t,i),e=!1},d(i){t&&t.d(i)}}}function Xe(l){let e,n,t;return{c(){e=w("input"),m(e,"class","answer-input svelte-1bcqse5"),e.disabled=l[16],m(e,"autocomplete","off"),m(e,"inputmode","text"),m(e,"aria-label","Answer")},m(i,s){P(i,e,s),l[19](e),ae(e,l[0]),n||(t=[x(e,"input",l[20]),x(e,"input",function(){oe(l[14])&&l[14].apply(this,arguments)}),x(e,"keydown",function(){oe(l[15])&&l[15].apply(this,arguments)})],n=!0)},p(i,s){l=i,s&65536&&(e.disabled=l[16]),s&1&&e.value!==l[0]&&ae(e,l[0])},d(i){i&&M(e),l[19](null),n=!1,Ce(t)}}}function Je(l){let e,n;return e=new Y({props:{area:"answer",$$slots:{default:[Xe]},$$scope:{ctx:l}}}),{c(){O(e.$$.fragment)},m(t,i){H(e,t,i),n=!0},p(t,i){const s={};i&2211843&&(s.$$scope={dirty:i,ctx:t}),e.$set(s)},i(t){n||(q(e.$$.fragment,t),n=!0)},o(t){T(e.$$.fragment,t),n=!1},d(t){j(e,t)}}}function Ye(l){let e,n,t;const i=l[18]["footer-left"],s=G(i,l,l[21],he),f=l[18]["footer-right"],r=G(f,l,l[21],de);return{c(){e=w("div"),s&&s.c(),n=E(),r&&r.c(),m(e,"class","footer-stats svelte-1bcqse5")},m(o,u){P(o,e,u),s&&s.m(e,null),g(e,n),r&&r.m(e,null),t=!0},p(o,u){s&&s.p&&(!t||u&2097152)&&K(s,i,o,o[21],t?U(i,o[21],u,Ke):N(o[21]),he),r&&r.p&&(!t||u&2097152)&&K(r,f,o,o[21],t?U(f,o[21],u,Ge):N(o[21]),de)},i(o){t||(q(s,o),q(r,o),t=!0)},o(o){T(s,o),T(r,o),t=!1},d(o){o&&M(e),s&&s.d(o),r&&r.d(o)}}}function xe(l){let e;const n=l[18].footer,t=G(n,l,l[21],be),i=t||Ye(l);return{c(){i&&i.c()},m(s,f){i&&i.m(s,f),e=!0},p(s,f){t?t.p&&(!e||f&2097152)&&K(t,n,s,s[21],e?U(n,s[21],f,Ne):N(s[21]),be):i&&i.p&&(!e||f&2097152)&&i.p(s,e?f:-1)},i(s){e||(q(i,s),e=!0)},o(s){T(i,s),e=!1},d(s){i&&i.d(s)}}}function $e(l){let e,n,t,i,s,f,r,o,u,b,d,p,I,h,k,y,c;const C=l[18]["header-left"],_=G(C,l,l[21],ke);u=new Ee({props:{levelId:l[3],total:l[4],correct:l[5],showTimer:l[6],remainingSeconds:l[7]}});const S=l[18].problem,R=G(S,l,l[21],ye),z=R||Ve(l);let L=l[17]&&Ze(l);const V=l[18].answer,Z=G(V,l,l[21],ve),F=Z||Je(l);return y=new Y({props:{area:"footer",$$slots:{default:[xe]},$$scope:{ctx:l}}}),{c(){e=w("div"),n=w("div"),t=w("header"),i=w("div"),_&&_.c(),s=E(),f=w("h1"),r=A(l[2]),o=E(),O(u.$$.fragment),b=E(),d=w("main"),p=w("div"),z&&z.c(),I=E(),L&&L.c(),h=E(),F&&F.c(),k=E(),O(y.$$.fragment),m(f,"class","main-title svelte-1bcqse5"),m(i,"class","header-left svelte-1bcqse5"),m(t,"class","app-header svelte-1bcqse5"),m(p,"class","trainer-grid grid-modular svelte-1bcqse5"),m(d,"class","app-main svelte-1bcqse5"),m(n,"class","app-frame svelte-1bcqse5"),m(e,"class","trainer-layout svelte-1bcqse5")},m(a,v){P(a,e,v),g(e,n),g(n,t),g(t,i),_&&_.m(i,null),g(i,s),g(i,f),g(f,r),g(t,o),H(u,t,null),g(n,b),g(n,d),g(d,p),z&&z.m(p,null),g(p,I),L&&L.m(p,null),g(p,h),F&&F.m(p,null),g(p,k),H(y,p,null),c=!0},p(a,[v]){_&&_.p&&(!c||v&2097152)&&K(_,C,a,a[21],c?U(C,a[21],v,He):N(a[21]),ke),(!c||v&4)&&W(r,a[2]);const B={};v&8&&(B.levelId=a[3]),v&16&&(B.total=a[4]),v&32&&(B.correct=a[5]),v&64&&(B.showTimer=a[6]),v&128&&(B.remainingSeconds=a[7]),u.$set(B),R?R.p&&(!c||v&2097152)&&K(R,S,a,a[21],c?U(S,a[21],v,je):N(a[21]),ye):z&&z.p&&(!c||v&16128)&&z.p(a,c?v:-1),a[17]&&L.p(a,v),Z?Z.p&&(!c||v&2097152)&&K(Z,V,a,a[21],c?U(V,a[21],v,Ue):N(a[21]),ve):F&&F.p&&(!c||v&114691)&&F.p(a,c?v:-1);const D={};v&2097152&&(D.$$scope={dirty:v,ctx:a}),y.$set(D)},i(a){c||(q(_,a),q(u.$$.fragment,a),q(z,a),q(L),q(F,a),q(y.$$.fragment,a),c=!0)},o(a){T(_,a),T(u.$$.fragment,a),T(z,a),T(L),T(F,a),T(y.$$.fragment,a),c=!1},d(a){a&&M(e),_&&_.d(a),j(u),z&&z.d(a),L&&L.d(),F&&F.d(a),j(y)}}}function ee(){try{return typeof window<"u"&&typeof window.matchMedia=="function"&&window.matchMedia("(hover: hover) and (pointer: fine)").matches?!0:typeof window<"u"&&window.innerWidth>=1024}catch{return!1}}function et(l,e,n){let{$$slots:t={},$$scope:i}=e;const s=qe(t),f=!!(s!=null&&s.image);let{title:r=""}=e,{levelId:o}=e,{total:u}=e,{correct:b}=e,{showTimer:d=!1}=e,{remainingSeconds:p=0}=e,{question:I=""}=e,{flash:h=!1}=e,{penalty:k=!1}=e,{overlayLabel:y=""}=e,{overlayColor:c=""}=e,{overlayTrigger:C=0}=e,{input:_=""}=e,{inputEl:S=null}=e,{handleInput:R}=e,{handleInputKey:z}=e,{disabled:L=!1}=e;function V(a){if(!ee())return;const v=a.target,B=(v==null?void 0:v.tagName)??"";if(["INPUT","TEXTAREA","SELECT"].includes(B))return void 0;if(L||a.key==="Shift"||a.key==="Control"||a.key==="Alt"||a.key==="Meta")return;S==null||S.focus();let D=_??"";if(a.key==="Backspace")D=D.slice(0,-1),a.preventDefault(),a.stopImmediatePropagation();else if(a.key==="Escape")D="",a.preventDefault(),a.stopImmediatePropagation();else if(a.key==="Enter"){z&&z(a),a.preventDefault(),a.stopImmediatePropagation();return}else if(a.key.length===1)D=D+a.key,a.preventDefault(),a.stopImmediatePropagation();else return;if(typeof R=="function")R({target:{value:D}});else if(S){n(0,_=D),n(1,S.value=D,S);const le=new Event("input",{bubbles:!0});S.dispatchEvent(le)}}ze(()=>{setTimeout(()=>S==null?void 0:S.focus(),0),ee()&&window.addEventListener("keydown",V)}),Te(()=>{ee()&&window.removeEventListener("keydown",V)});function Z(a){te[a?"unshift":"push"](()=>{S=a,n(1,S)})}function F(){_=this.value,n(0,_)}return l.$$set=a=>{"title"in a&&n(2,r=a.title),"levelId"in a&&n(3,o=a.levelId),"total"in a&&n(4,u=a.total),"correct"in a&&n(5,b=a.correct),"showTimer"in a&&n(6,d=a.showTimer),"remainingSeconds"in a&&n(7,p=a.remainingSeconds),"question"in a&&n(8,I=a.question),"flash"in a&&n(9,h=a.flash),"penalty"in a&&n(10,k=a.penalty),"overlayLabel"in a&&n(11,y=a.overlayLabel),"overlayColor"in a&&n(12,c=a.overlayColor),"overlayTrigger"in a&&n(13,C=a.overlayTrigger),"input"in a&&n(0,_=a.input),"inputEl"in a&&n(1,S=a.inputEl),"handleInput"in a&&n(14,R=a.handleInput),"handleInputKey"in a&&n(15,z=a.handleInputKey),"disabled"in a&&n(16,L=a.disabled),"$$scope"in a&&n(21,i=a.$$scope)},[_,S,r,o,u,b,d,p,I,h,k,y,c,C,R,z,L,f,t,Z,F,i]}class it extends X{constructor(e){super(),J(this,e,et,$e,Q,{title:2,levelId:3,total:4,correct:5,showTimer:6,remainingSeconds:7,question:8,flash:9,penalty:10,overlayLabel:11,overlayColor:12,overlayTrigger:13,input:0,inputEl:1,handleInput:14,handleInputKey:15,disabled:16})}}export{it as G};
