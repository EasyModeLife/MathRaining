import{S as te,i as ne,s as oe,b as D,a as B,d as N,t as P,c as Q,e as O,m as G,f as K,g as re,o as se,h as ie,j as V,k as H,l as X,n as z,p as U,q as I,r as S}from"./index-CD1SmJcG.js";import{G as ae}from"./GameFrame-DpBzU2T0.js";import le from"./Math-BOqx12LK.js";const fe=[{id:1,topics:["derivative-poly"],total:10,desc:"Derivadas de polinomios simples"},{id:2,topics:["integral-poly"],total:10,desc:"Integrales de polinomios básicas"},{id:3,topics:["derivative-trig"],total:12,desc:"Derivadas trigonométricas"},{id:4,topics:["differential-poly"],total:12,desc:"Diferenciales: dy = f’(x) dx"},{id:5,topics:["derivative-poly","integral-poly","derivative-trig","differential-poly"],total:14,desc:"Mixto de cálculo"}];function J(t){return fe.find(n=>n.id===t)}function ce(t){return J(t+1)}function g(t,n){return Math.floor(Math.random()*(n-t+1))+t}function q(t){return t==="derivative-trig"?1e4:t==="differential-poly"?14e3:12e3}function b(t){const n=[];t.forEach((s,a)=>{const i=t.length-1-a;if(s===0)return;const l=s>0?"+":"-",c=Math.abs(s);let o="";i===0?o=`${c}`:c===1?o=i===1?"x":`x^{${i}}`:o=i===1?`${c}x`:`${c}x^{${i}}`,n.push(`${l} ${o}`)});let e=n.join(" ");return e=e.replace(/^\+\s?/,"").trim(),e||"0"}function j(t){const n=[];for(let e=0;e<t.length-1;e++){const s=t.length-1-e;n.push(t[e]*s)}return n.length?n:[0]}function ue(t){const n=[];for(let s=0;s<t.length;s++){const i=t.length-1-s+1,l=t[s]/i;if(l===0)continue;const c=l>0?"+":"-",o=Math.abs(l);let r="";i===0?r=`${o}`:o===1?r=i===1?"x":`x^{${i}}`:r=i===1?`${o}x`:`${o}x^{${i}}`,n.push(`${c} ${r}`)}const e=n.join(" ").replace(/^\+\s/,"").trim();return e?`${e} + C`:"C"}function pe(t,n){return t.reduce((e,s)=>e*n+s,0)}function me(t){var f,y;const n=t[g(0,t.length-1)];if(n==="derivative-poly"){const p=g(1,3),u=Array.from({length:p+1},()=>g(-6,6));u[0]===0&&(u[0]=g(1,6));const h=`\\frac{d}{dx} [${b(u)}]`,_=b(j(u)).replace(/^\+\s?/,"").trim();return{id:((y=(f=globalThis.crypto)==null?void 0:f.randomUUID)==null?void 0:y.call(f))||Math.random().toString(36).slice(2),question:h,answer:_,topic:n,timeMs:q(n)}}if(n==="integral-poly"){const p=g(0,3),u=Array.from({length:p+1},()=>g(-5,5));u.reduce((w,T)=>w+Math.abs(T),0)===0&&(u[p]=1);const _=`\\int (${b(u)}) \\, dx`,M=ue(u);return{id:Math.random().toString(36).slice(2),question:_,answer:M,topic:n,timeMs:q(n)}}if(n==="derivative-trig"){const p=["\\sin x","\\cos x","\\tan x"],u=p[g(0,p.length-1)],d=`\\frac{d}{dx} [${u}]`,h=u==="\\sin x"?"\\cos x":u==="\\cos x"?"-\\sin x":"\\sec^{2} x";return{id:Math.random().toString(36).slice(2),question:d,answer:h,topic:n,timeMs:q(n)}}const e=g(1,3),s=Array.from({length:e+1},()=>g(-5,5));s[0]===0&&(s[0]=g(1,5));const a=j(s),i=g(-4,4),l=b(s),c=b(a).replace(/^\+\s?/,""),o=`\\text{If } y = ${l}, \\text{ find } dy \\text{ at } x = ${i} \\text{ } (dy = y'(x) \\, dx)`,r=`dy = (${c}) \\, dx, \\quad y'(${i}) = ${pe(a,i)}`;return{id:Math.random().toString(36).slice(2),question:o,answer:r,topic:"differential-poly",timeMs:q(n)}}function ge(t){let n,e,s;return e=new le({props:{expr:`\\displaystyle \\text{Time: } ${((performance.now()-t[11])/1e3).toFixed(1)}\\,\\text{s}`}}),{c(){n=X("span"),K(e.$$.fragment),z(n,"slot","footer-left")},m(a,i){H(a,n,i),G(e,n,null),s=!0},p(a,i){const l={};i&2048&&(l.expr=`\\displaystyle \\text{Time: } ${((performance.now()-a[11])/1e3).toFixed(1)}\\,\\text{s}`),e.$set(l)},i(a){s||(Q(e.$$.fragment,a),s=!0)},o(a){P(e.$$.fragment,a),s=!1},d(a){a&&V(n),N(e)}}}function de(t){let n,e,s=t[0].id+"",a,i,l=t[0].topics.length+"",c;return{c(){n=X("span"),e=S("Level: "),a=S(s),i=S(" • Topics: "),c=S(l),z(n,"slot","footer-right")},m(o,r){H(o,n,r),I(n,e),I(n,a),I(n,i),I(n,c)},p(o,r){r&1&&s!==(s=o[0].id+"")&&U(a,s),r&1&&l!==(l=o[0].topics.length+"")&&U(c,l)},d(o){o&&V(n)}}}function he(t){let n,e,s,a;function i(o){t[16](o)}function l(o){t[17](o)}let c={title:"Calculus",levelId:t[0].id,total:t[0].total,correct:t[12],showTimer:!t[6],remainingSeconds:t[7]/1e3,question:t[1].question,flash:t[4],penalty:t[5],overlayLabel:t[8],overlayColor:t[9],overlayTrigger:t[10],handleInput:t[13],handleInputKey:t[14],$$slots:{"footer-right":[de],"footer-left":[ge]},$$scope:{ctx:t}};return t[3]!==void 0&&(c.inputEl=t[3]),t[2]!==void 0&&(c.input=t[2]),n=new ae({props:c}),D.push(()=>B(n,"inputEl",i)),D.push(()=>B(n,"input",l)),{c(){K(n.$$.fragment)},m(o,r){G(n,o,r),a=!0},p(o,[r]){const f={};r&1&&(f.levelId=o[0].id),r&1&&(f.total=o[0].total),r&4096&&(f.correct=o[12]),r&64&&(f.showTimer=!o[6]),r&128&&(f.remainingSeconds=o[7]/1e3),r&2&&(f.question=o[1].question),r&16&&(f.flash=o[4]),r&32&&(f.penalty=o[5]),r&256&&(f.overlayLabel=o[8]),r&512&&(f.overlayColor=o[9]),r&1024&&(f.overlayTrigger=o[10]),r&134219777&&(f.$$scope={dirty:r,ctx:o}),!e&&r&8&&(e=!0,f.inputEl=o[3],O(()=>e=!1)),!s&&r&4&&(s=!0,f.input=o[2],O(()=>s=!1)),n.$set(f)},i(o){a||(Q(n.$$.fragment,o),a=!0)},o(o){P(n.$$.fragment,o),a=!1},d(o){N(n,o)}}}const k=12e3;function _e(t,n,e){let s;const a=re();let i=J(1),l,c="",o=null,r=0,f=!1,y=!1,p=!0,u=0,d=k,h,_=!1;performance.now();let M="",w="",T=0,A=performance.now();function R(){return me(i.topics)}function C(){e(1,l=R()),p?(u=0,e(7,d=l.timeMs)):(u=performance.now()+l.timeMs,e(7,d=l.timeMs)),_=!1,performance.now()}function W(){e(15,r=0),e(2,c=""),e(4,f=!1),e(6,p=!0),e(11,A=performance.now()),C()}W();function L(m){let E=m.trim();if(e(2,c=E),!E)return;const F=x=>x.replace(/\s+/g," ").replace(/\s([+\-])/g," $1").replace(/^\+\s?/,"").trim().toLowerCase();if(F(E)===F(l.answer)){e(8,M="correct"),e(9,w="#BCED09"),e(10,T+=1),e(4,f=!0),e(15,r+=1),a("answer",{correct:!0});const x=r>=i.total;setTimeout(()=>{if(x){const v=ce(i.id);v&&(e(0,i=v),e(15,r=0),e(6,p=!0))}else e(6,p=!1);e(2,c=""),e(4,f=!1),C()},200)}}function Y(m){L(m.target.value)}function Z(m){m.key==="Enter"&&L(c)}se(()=>{setTimeout(()=>o==null?void 0:o.focus(),0);const m=()=>{var E;u>0?(e(7,d=Math.max(0,u-performance.now())),!_&&d<=0&&(a("answer",{correct:!1}),_=!0,e(15,r=Math.max(0,r-1)),e(8,M="miss"),e(9,w="#FF715B"),e(10,T+=1),e(5,y=!0),setTimeout(()=>e(5,y=!1),250),e(6,p=!1),e(2,c=""),e(4,f=!1),C())):e(7,d=(E=l==null?void 0:l.timeMs)!=null?E:k),h=requestAnimationFrame(m)};u=0,h=requestAnimationFrame(m)}),ie(()=>cancelAnimationFrame(h));function $(m){o=m,e(3,o)}function ee(m){c=m,e(2,c)}return t.$$.update=()=>{t.$$.dirty&32768&&e(12,s=Math.max(0,r))},[i,l,c,o,f,y,p,d,M,w,T,A,s,Y,Z,r,$,ee]}class we extends te{constructor(n){super(),ne(this,n,_e,he,oe,{})}}export{we as default};
