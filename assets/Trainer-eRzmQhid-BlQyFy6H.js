import{K as te,U as ne,j as oe,y as j,o as D,P as K,k as O,v as R,c as k,E as z,L as J,a as ie,O as re,l as se,b as P,$ as W,p as Y,d as Z,n as U,e as w,z as q}from"./index-CFTrthGh.js";import{a as ae}from"./GameFrame-DpBzU2T0-DDxwDYeb.js";import le from"./Math-BOqx12LK-CJRqjFux.js";const ce=[{id:1,topics:["derivative-poly"],total:10,desc:"Derivadas de polinomios simples"},{id:2,topics:["integral-poly"],total:10,desc:"Integrales de polinomios básicas"},{id:3,topics:["derivative-trig"],total:12,desc:"Derivadas trigonométricas"},{id:4,topics:["differential-poly"],total:12,desc:"Diferenciales: dy = f’(x) dx"},{id:5,topics:["derivative-poly","integral-poly","derivative-trig","differential-poly"],total:14,desc:"Mixto de cálculo"}];function G(t){return ce.find(o=>o.id===t)}function ue(t){return G(t+1)}function $(t,o){return Math.floor(Math.random()*(o-t+1))+t}function T(t){return t==="derivative-trig"?1e4:t==="differential-poly"?14e3:12e3}function M(t){const o=[];t.forEach((i,s)=>{const l=t.length-1-s;if(i===0)return;const c=i>0?"+":"-",a=Math.abs(i);let n="";l===0?n=`${a}`:a===1?n=l===1?"x":`x^{${l}}`:n=l===1?`${a}x`:`${a}x^{${l}}`,o.push(`${c} ${n}`)});let e=o.join(" ");return e=e.replace(/^\+\s?/,"").trim(),e||"0"}function _(t){const o=[];for(let e=0;e<t.length-1;e++){const i=t.length-1-e;o.push(t[e]*i)}return o.length?o:[0]}function fe(t){const o=[];for(let i=0;i<t.length;i++){const s=t.length-1-i+1,l=t[i]/s;if(l===0)continue;const c=l>0?"+":"-",a=Math.abs(l);let n="";s===0?n=`${a}`:a===1?n=s===1?"x":`x^{${s}}`:n=s===1?`${a}x`:`${a}x^{${s}}`,o.push(`${c} ${n}`)}const e=o.join(" ").replace(/^\+\s/,"").trim();return e?`${e} + C`:"C"}function de(t,o){return t.reduce((e,i)=>e*o+i,0)}function pe(t){var o,e;const i=t[$(0,t.length-1)];if(i==="derivative-poly"){const d=$(1,3),f=Array.from({length:d+1},()=>$(-6,6));f[0]===0&&(f[0]=$(1,6));const p=`\\frac{d}{dx} [${M(f)}]`,g=M(_(f)).replace(/^\+\s?/,"").trim();return{id:((e=(o=globalThis.crypto)==null?void 0:o.randomUUID)==null?void 0:e.call(o))||Math.random().toString(36).slice(2),question:p,answer:g,topic:i,timeMs:T(i)}}if(i==="integral-poly"){const d=$(0,3),f=Array.from({length:d+1},()=>$(-5,5));f.reduce((y,v)=>y+Math.abs(v),0)===0&&(f[d]=1);const p=`\\int (${M(f)}) \\, dx`,g=fe(f);return{id:Math.random().toString(36).slice(2),question:p,answer:g,topic:i,timeMs:T(i)}}if(i==="derivative-trig"){const d=["\\sin x","\\cos x","\\tan x"],f=d[$(0,d.length-1)],p=`\\frac{d}{dx} [${f}]`,g=f==="\\sin x"?"\\cos x":f==="\\cos x"?"-\\sin x":"\\sec^{2} x";return{id:Math.random().toString(36).slice(2),question:p,answer:g,topic:i,timeMs:T(i)}}const s=$(1,3),l=Array.from({length:s+1},()=>$(-5,5));l[0]===0&&(l[0]=$(1,5));const c=_(l),a=$(-4,4),n=M(l),r=M(c).replace(/^\+\s?/,""),u=`\\text{If } y = ${n}, \\text{ find } dy \\text{ at } x = ${a} \\text{ } (dy = y'(x) \\, dx)`,h=`dy = (${r}) \\, dx, \\quad y'(${a}) = ${de(c,a)}`;return{id:Math.random().toString(36).slice(2),question:u,answer:h,topic:"differential-poly",timeMs:T(i)}}function me(t){let o,e,i;return e=new le({props:{expr:`\\displaystyle \\text{Time: } ${((performance.now()-t[11])/1e3).toFixed(1)}\\,\\text{s}`}}),{c(){o=Y("span"),J(e.$$.fragment),Z(o,"slot","footer-left")},m(s,l){W(s,o,l),z(e,o,null),i=!0},p(s,l){const c={};l&2048&&(c.expr=`\\displaystyle \\text{Time: } ${((performance.now()-s[11])/1e3).toFixed(1)}\\,\\text{s}`),e.$set(c)},i(s){i||(R(e.$$.fragment,s),i=!0)},o(s){O(e.$$.fragment,s),i=!1},d(s){s&&P(o),K(e)}}}function $e(t){let o,e,i=t[0].id+"",s,l,c=t[0].topics.length+"",a;return{c(){o=Y("span"),e=q("Level: "),s=q(i),l=q(" • Topics: "),a=q(c),Z(o,"slot","footer-right")},m(n,r){W(n,o,r),w(o,e),w(o,s),w(o,l),w(o,a)},p(n,r){r&1&&i!==(i=n[0].id+"")&&U(s,i),r&1&&c!==(c=n[0].topics.length+"")&&U(a,c)},d(n){n&&P(o)}}}function ge(t){let o,e,i,s;function l(n){t[16](n)}function c(n){t[17](n)}let a={title:"Calculus",levelId:t[0].id,total:t[0].total,correct:t[12],showTimer:!t[6],remainingSeconds:t[7]/1e3,question:t[1].question,flash:t[4],penalty:t[5],overlayLabel:t[8],overlayColor:t[9],overlayTrigger:t[10],handleInput:t[13],handleInputKey:t[14],$$slots:{"footer-right":[$e],"footer-left":[me]},$$scope:{ctx:t}};return t[3]!==void 0&&(a.inputEl=t[3]),t[2]!==void 0&&(a.input=t[2]),o=new ae({props:a}),j.push(()=>D(o,"inputEl",l)),j.push(()=>D(o,"input",c)),{c(){J(o.$$.fragment)},m(n,r){z(o,n,r),s=!0},p(n,[r]){const u={};r&1&&(u.levelId=n[0].id),r&1&&(u.total=n[0].total),r&4096&&(u.correct=n[12]),r&64&&(u.showTimer=!n[6]),r&128&&(u.remainingSeconds=n[7]/1e3),r&2&&(u.question=n[1].question),r&16&&(u.flash=n[4]),r&32&&(u.penalty=n[5]),r&256&&(u.overlayLabel=n[8]),r&512&&(u.overlayColor=n[9]),r&1024&&(u.overlayTrigger=n[10]),r&134219777&&(u.$$scope={dirty:r,ctx:n}),!e&&r&8&&(e=!0,u.inputEl=n[3],k(()=>e=!1)),!i&&r&4&&(i=!0,u.input=n[2],k(()=>i=!1)),o.$set(u)},i(n){s||(R(o.$$.fragment,n),s=!0)},o(n){O(o.$$.fragment,n),s=!1},d(n){K(o,n)}}}const B=12e3;function xe(t,o,e){let i;const s=ie();let l=G(1),c,a="",n=null,r=0,u=!1,h=!1,d=!0,f=0,p=B,g,y=!1;performance.now();let v="",b="",E=0,A=performance.now();function H(){return pe(l.topics)}function C(){e(1,c=H()),d?(f=0,e(7,p=c.timeMs)):(f=performance.now()+c.timeMs,e(7,p=c.timeMs)),y=!1,performance.now()}function N(){e(15,r=0),e(2,a=""),e(4,u=!1),e(6,d=!0),e(11,A=performance.now()),C()}N();function I(m){let x=m.trim();if(e(2,a=x),!x)return;const L=F=>F.replace(/\s+/g," ").replace(/\s([+\-])/g," $1").replace(/^\+\s?/,"").trim().toLowerCase();if(L(x)===L(c.answer)){e(8,v="correct"),e(9,b="#BCED09"),e(10,E+=1),e(4,u=!0),e(15,r+=1),s("answer",{correct:!0});const F=r>=l.total;setTimeout(()=>{if(F){const S=ue(l.id);S&&(e(0,l=S),e(15,r=0),e(6,d=!0))}else e(6,d=!1);e(2,a=""),e(4,u=!1),C()},200)}}function Q(m){I(m.target.value)}function V(m){m.key==="Enter"&&I(a)}re(()=>{setTimeout(()=>n==null?void 0:n.focus(),0);const m=()=>{var x;f>0?(e(7,p=Math.max(0,f-performance.now())),!y&&p<=0&&(s("answer",{correct:!1}),y=!0,e(15,r=Math.max(0,r-1)),e(8,v="miss"),e(9,b="#FF715B"),e(10,E+=1),e(5,h=!0),setTimeout(()=>e(5,h=!1),250),e(6,d=!1),e(2,a=""),e(4,u=!1),C())):e(7,p=(x=c==null?void 0:c.timeMs)!=null?x:B),g=requestAnimationFrame(m)};f=0,g=requestAnimationFrame(m)}),se(()=>cancelAnimationFrame(g));function X(m){n=m,e(3,n)}function ee(m){a=m,e(2,a)}return t.$$.update=()=>{t.$$.dirty&32768&&e(12,i=Math.max(0,r))},[l,c,a,n,u,h,d,p,v,b,E,A,i,Q,V,r,X,ee]}class Me extends te{constructor(o){super(),ne(this,o,xe,ge,oe,{})}}export{Me as default};
