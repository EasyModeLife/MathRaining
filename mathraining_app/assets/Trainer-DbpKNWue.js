import{S as Z,d as $,e as P,h as Q,t as I,b as q,a as ee,c as te,l as G,A as oe,F as ne,G as re,J as se,K as D,L as F,x as ie,M as B,z as ae,y as le,j as ce,m as O,p as fe,u as j,k as ue,v as pe}from"./index-DcqVJR58.js";import{G as me}from"./GameFrame-C_UA1VlH.js";/* empty css                                           */import"./SubNav-qWaH2tGl.js";import"./Math-Dbfjb61U.js";const ge=[{id:1,topics:["derivative-poly"],total:10,desc:"Derivadas de polinomios simples"},{id:2,topics:["integral-poly"],total:10,desc:"Integrales de polinomios básicas"},{id:3,topics:["derivative-trig"],total:12,desc:"Derivadas trigonométricas"},{id:4,topics:["differential-poly"],total:12,desc:"Diferenciales: dy = f’(x) dx"},{id:5,topics:["derivative-poly","integral-poly","derivative-trig","differential-poly"],total:14,desc:"Mixto de cálculo"}];function V(t){return ge.find(o=>o.id===t)}function de(t){return V(t+1)}function p(t,o){if(globalThis.crypto){const e=new Uint32Array(1);globalThis.crypto.getRandomValues(e);const s=e[0]/(2**32-1);return Math.floor(s*(o-t+1))+t}return Math.floor(Math.random()*(o-t+1))+t}function S(t){return t==="derivative-trig"?15e3:t==="differential-poly"?19e3:17e3}function b(t){const o=[];t.forEach((s,l)=>{const r=t.length-1-l;if(s===0)return;const c=s>0?"+":"-",f=Math.abs(s);let n="";r===0?n=`${f}`:f===1?n=r===1?"x":`x^{${r}}`:n=r===1?`${f}x`:`${f}x^{${r}}`,o.push(`${c} ${n}`)});let e=o.join(" ");return e=e.replace(/^\+\s?/,"").trim(),e||"0"}function x(t){const o=[];for(let e=0;e<t.length-1;e++){const s=t.length-1-e;o.push(t[e]*s)}return o.length?o:[0]}function he(t){const o=[];for(let s=0;s<t.length;s++){const r=t.length-1-s+1,c=t[s]/r;if(c===0)continue;const f=c>0?"+":"-",n=Math.abs(c);let i="";r===0?i=`${n}`:n===1?i=r===1?"x":`x^{${r}}`:i=r===1?`${n}x`:`${n}x^{${r}}`,o.push(`${f} ${i}`)}const e=o.join(" ").replace(/^\+\s/,"").trim();return e?`${e} + C`:"C"}function _e(t,o){return t.reduce((e,s)=>e*o+s,0)}function ye(t){const o=t[p(0,t.length-1)];if(o==="derivative-poly"){const a=p(1,3);let u=Array.from({length:a+1},()=>p(-6,6));u[0]===0&&(u[0]=p(1,6)),u.every(y=>y===0)&&(u=[p(1,6),...u.slice(1)]);const d=`\\frac{d}{dx} [${b(u)}]`,h=x(u),_=b(h).replace(/^\+\s?/,"").trim();return{id:`${Math.random().toString(36).slice(2)}${Date.now().toString(36)}`,question:d,answer:_,topic:o,timeMs:S(o)}}if(o==="integral-poly"){const a=p(0,3);let u=Array.from({length:a+1},()=>p(-5,5));u.reduce((M,y)=>M+Math.abs(y),0)===0&&(u=[...u.slice(0,-1),p(1,5)]);const h=`\\int (${b(u)}) \\, dx`,_=he(u);return{id:`${Math.random().toString(36).slice(2)}${Date.now().toString(36)}`,question:h,answer:_,topic:o,timeMs:S(o)}}if(o==="derivative-trig"){const a=["\\sin x","\\cos x","\\tan x"],u=a[p(0,a.length-1)],g=`\\frac{d}{dx} [${u}]`,d=u==="\\sin x"?"\\cos x":u==="\\cos x"?"-\\sin x":"\\sec^{2} x";return{id:`${Math.random().toString(36).slice(2)}${Date.now().toString(36)}`,question:g,answer:d,topic:o,timeMs:S(o)}}const e=p(1,3);let s=Array.from({length:e+1},()=>p(-5,5));s[0]===0&&(s[0]=p(1,5)),s.every(a=>a===0)&&(s=[p(1,5),...s.slice(1)]);const l=x(s),r=p(-4,4),c=b(s),f=b(l).replace(/^\+\s?/,""),n=`\\text{If } y = ${c}, \\text{ find } dy \\text{ at } x = ${r} \\text{ } (dy = y'(x) \\, dx)`,i=`dy = (${f}) \\, dx, \\quad y'(${r}) = ${_e(l,r)}`;return{id:`${Math.random().toString(36).slice(2)}${Date.now().toString(36)}`,question:n,answer:i,topic:"differential-poly",timeMs:S(o)}}function Me(t){let o,e,s=t[0].topics.length+"",l;return{c(){o=fe("span"),e=j("Topics: "),l=j(s),ue(o,"slot","footer-right")},m(r,c){G(r,o,c),O(o,e),O(o,l)},p(r,c){c&1&&s!==(s=r[0].topics.length+"")&&ce(l,s)},d(r){r&&Q(o)}}}function N(t){let o,e,s,l;function r(n){t[15](n)}function c(n){t[16](n)}let f={title:"Calculus",levelId:t[0].id,total:t[0].total,correct:t[11],showTimer:!t[6],remainingSeconds:t[7]/1e3,question:t[1].question,flash:t[4],penalty:t[5],overlayLabel:t[8],overlayColor:t[9],overlayTrigger:t[10],handleInput:t[12],handleInputKey:t[13],$$slots:{"footer-right":[Me]},$$scope:{ctx:t}};return t[3]!==void 0&&(f.inputEl=t[3]),t[2]!==void 0&&(f.input=t[2]),o=new me({props:f}),D.push(()=>F(o,"inputEl",r)),D.push(()=>F(o,"input",c)),{c(){le(o.$$.fragment)},m(n,i){ae(o,n,i),l=!0},p(n,i){const a={};i&1&&(a.levelId=n[0].id),i&1&&(a.total=n[0].total),i&2048&&(a.correct=n[11]),i&64&&(a.showTimer=!n[6]),i&128&&(a.remainingSeconds=n[7]/1e3),i&2&&(a.question=n[1].question),i&16&&(a.flash=n[4]),i&32&&(a.penalty=n[5]),i&256&&(a.overlayLabel=n[8]),i&512&&(a.overlayColor=n[9]),i&1024&&(a.overlayTrigger=n[10]),i&134217729&&(a.$$scope={dirty:i,ctx:n}),!e&&i&8&&(e=!0,a.inputEl=n[3],B(()=>e=!1)),!s&&i&4&&(s=!0,a.input=n[2],B(()=>s=!1)),o.$set(a)},i(n){l||(q(o.$$.fragment,n),l=!0)},o(n){I(o.$$.fragment,n),l=!1},d(n){ie(o,n)}}}function we(t){let o=t[1].id,e,s,l=N(t);return{c(){l.c(),e=oe()},m(r,c){l.m(r,c),G(r,e,c),s=!0},p(r,[c]){c&2&&P(o,o=r[1].id)?(ee(),I(l,1,1,pe),te(),l=N(r),l.c(),q(l,1),l.m(e.parentNode,e)):l.p(r,c)},i(r){s||(q(l),s=!0)},o(r){I(l),s=!1},d(r){r&&Q(e),l.d(r)}}}const U=12e3;function be(t,o,e){let s;const l=ne();let r=V(1),c,f="",n=null,i=0,a=!1,u=!1,g=!0,d=0,h=U,_,M=!1;performance.now();let y="",T="",C=0;performance.now();function z(){return ye(r.topics)}function E(){e(1,c=z()),g?(d=0,e(7,h=c.timeMs)):(d=performance.now()+c.timeMs,e(7,h=c.timeMs)),M=!1,performance.now()}function K(){e(14,i=0),e(2,f=""),e(4,a=!1),e(6,g=!0),performance.now(),E()}K();function k(m){let w=m.trim();if(e(2,f=w),!w)return;const v=A=>A.replace(/\\/g,"").replace(/\{(\d+)\}/g,"$1").replace(/frac\{([^}]+)\}\{([^}]+)\}/g,"$1/$2").replace(/\^\{(\w+)\}/g,"^$1").replace(/\^\{([^}]*)\}/g,"^$1").replace(/\s*([-+])\s*/g,"$1").replace(/\s+/g," ").replace(/^\+\s?/,"").replace(/^-\s*0(\s|$)/,"0$1").trim().toLowerCase(),W=v(w),Y=v(c.answer);if(W===Y){e(8,y="correct"),e(9,T="#BCED09"),e(10,C+=1),e(4,a=!0),e(14,i+=1),l("answer",{correct:!0});const A=i>=r.total;setTimeout(()=>{if(e(2,f=""),e(4,a=!1),A){const L=de(r.id);L&&(e(0,r=L),e(14,i=0),e(6,g=!0),E())}else e(6,g=!1),E()},200)}}function R(m){k(m.target.value)}function H(m){m.key==="Enter"&&k(f)}re(()=>{setTimeout(()=>n==null?void 0:n.focus(),0);const m=()=>{var w;d>0?(e(7,h=Math.max(0,d-performance.now())),!M&&h<=0&&(l("answer",{correct:!1}),M=!0,e(14,i=Math.max(0,i-1)),e(8,y="miss"),e(9,T="#FF715B"),e(10,C+=1),e(5,u=!0),setTimeout(()=>e(5,u=!1),250),e(6,g=!1),e(2,f=""),e(4,a=!1),E())):e(7,h=(w=c==null?void 0:c.timeMs)!=null?w:U),_=requestAnimationFrame(m)};d=0,_=requestAnimationFrame(m)}),se(()=>cancelAnimationFrame(_));function J(m){n=m,e(3,n)}function X(m){f=m,e(2,f)}return t.$$.update=()=>{t.$$.dirty&16384&&e(11,s=Math.max(0,i))},[r,c,f,n,a,u,g,h,y,T,C,s,R,H,i,J,X]}class qe extends Z{constructor(o){super(),$(this,o,be,we,P,{})}}export{qe as default};
